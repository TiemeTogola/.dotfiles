#!/bin/bash
#useful routines, deemed too short to be in their own files
#TODO: add status notifications

#run program, ignore output and return prompt immediately
run() {
  setsid $1 &> /dev/null
}

#open file, ignore output and return prompt immediately
go() {
  xdg-open $1 &> /dev/null
}

#lock screen and put computer to sleep
zzz() {
  gnome-screensaver-command -l

  dbus-send --system --print-reply \
    --dest="org.freedesktop.UPower" \
    /org/freedesktop/UPower \
    org.freedesktop.UPower.Suspend
}

#check spelling (f->french, default is english)
s() {
  word=$1
  option=''
  if [ $1 == 'f' ]; then
    option="-l fr"
    word=$2
  fi
  result="$(echo $word | aspell $option -a | tail -n 2)"
  if [ "$result" == "*" ]; then
    echo "OK"
  elif [ $(echo $result | grep "&" | wc -l) != 0 ]; then
    echo $result | sed "s|& $word \([0-9]\+\) [0-9]\+: |\1 suggestions:\n|"
  else
    echo "Unknown word"
  fi
}

#dictionary lookup (f->french, t->translate, default is english)
#TODO: highlight occurences of searched word
#      add colors (eg: type of word...), change format
#      fix annoying glitch with suggestions in less
sd() {
  word=$1
  option=''
  if [ $1 == 'f' ] || [ $1 == 't' ]; then
    option=$1
    word=$2
  fi
  export STARDICT_DATA_DIR=/usr/share/"$option"stardict
  sdcv $word | less
}

#m alias for music
#update cmus music automatically on start
m() {
  cmus & sleep 0.1
  cmus-remote -l ~/Music/ & fg
  clear
}

#update music folder and cmus lib with recent downloads
#TODO: add options
mu() {
  #check that folder is non-empty
  if [ "$(ls -A ~/Downloads/)" ]; then
    mv -i ~/Downloads/*.mp3 ~/Music/
    #check cmus socket is open
    if [ "$(ls -a ~/.cmus/ | grep socket | wc -l)" != 0 ]; then
      cmus-remote -l ~/Music/
    fi
  fi
}

#load music into specified mobile player
#TODO: option to specify target storage media
#      option to specify source playlist
ml() {
  mkdir -p ~/Desktop/tmpzik/
  #each line in source playlist is a path to a music file
  while read p; do
    "cp" "$p" ~/Desktop/tmpzik/
  done <~/.cmus/playlist.pl

  echo "still working on this"
}
